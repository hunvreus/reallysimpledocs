{% from "macros/command.njk" import command_dialog %}

{% set commandMenu = menu | commandMenu(collections) %}
{{ command_dialog(id="command-search", items=commandMenu, placeholder="Search the docs...") }}
<script>
  document.addEventListener('keydown', (e) => {
    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
      e.preventDefault();
      const dialog = document.getElementById('command-search');
      if (dialog.open) {
        dialog.close();
      } else {
        dialog.showModal();
        dialog.querySelector('header input')?.focus();
      }
    }
  });
</script>

<div class="flex h-14 w-full items-center justify-between gap-2 px-4">
  <button
    type="button"
    onclick="document.dispatchEvent(new CustomEvent('basecoat:sidebar'))"
    aria-label="Toggle sidebar"
    data-tooltip="Toggle sidebar"
    data-side="bottom"
    data-align="start"
    class="btn-sm-icon-ghost"
  >
    {% lucide "panel-left" %}
  </button>

  <button
    type="button"
    class="relative text-muted-foreground bg-background dark:bg-input/30 border-input flex items-center h-8 w-full min-w-0 rounded-md border px-3 py-1 gap-x-2 text-base md:text-sm focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] outline-none cursor-text max-w-72 sm:ml-auto"
    onclick="document.getElementById('command-search').showModal()"
  >
    {% lucide "search", { "class": "size-4" } %}
    Search the docs...
    <kbd class="kbd ml-auto -mr-1.5">âŒ˜K</kbd>
  </button>

  <nav class="items-center gap-2 hidden sm:flex">
    {% for link in site.links %}
      {% set icon = (link.icon or "") | trim %}
      <a
        {% if link.attrs and link.attrs.class %}
          class="{{ link.attrs.class }}"
        {% else %}
          class="{% if link.iconOnly %}btn-sm-icon-outline{% else %}btn-sm-outline{% endif %}"
        {% endif %}
        href="{{ link.url }}"
        aria-label="{{ link.label }}"
        data-tooltip="{{ link.label }}"
        data-side="bottom"
        {% if link.attrs %}
          {% for key, value in link.attrs %}
            {% if key != "class" %}{{ key }}="{{ value }}"{% endif %}
          {% endfor %}
        {% endif %}
      >
        {% if icon %}
          {% if icon.slice(0, 4) == "<svg" %}
            {{ icon | safe }}
          {% else %}
            {% lucide icon %}
          {% endif %}
        {% endif %}
        {% if not link.iconOnly %}{{ link.label }}{% endif %}
      </a>
    {% endfor %}
    <button
      type="button"
      aria-label="Toggle dark mode"
      data-tooltip="Toggle dark mode"
      data-side="bottom"
      data-align="end"
      onclick="document.dispatchEvent(new CustomEvent('basecoat:theme'))"
      class="btn-sm-icon-outline size-7"
    >
      <span class="hidden dark:block">{% lucide "sun" %}</span>
      <span class="block dark:hidden">{% lucide "moon" %}</span>
    </button>
  </nav>

  <div class="sm:hidden">
    <button
      type="button"
      class="btn-sm-icon-ghost peer group"
      aria-label="Toggle menu"
      aria-expanded="false"
      aria-controls="mobile-menu"
      onclick="this.setAttribute('aria-expanded', this.getAttribute('aria-expanded') === 'true' ? 'false' : 'true')"
    >
      <span class="group-aria-expanded:hidden">{% lucide "menu" %}</span>
      <span class="hidden group-aria-expanded:block">{% lucide "x" %}</span>
    </button>

    <nav
      id="mobile-menu"
      class="fixed inset-0 top-14 bg-background z-50 flex flex-col gap-2 p-4 transition-all opacity-0 scale-95 -translate-y-16 invisible pointer-events-none peer-aria-expanded:opacity-100 peer-aria-expanded:scale-100 peer-aria-expanded:translate-y-0 peer-aria-expanded:visible peer-aria-expanded:pointer-events-auto"
      data-mobile-menu
    >
      {% for link in site.links %}
        {% set icon = (link.icon or "") | trim %}
        <a
          class="btn-lg-ghost justify-between {{ link.class }}"
          href="{{ link.url }}"
          {% if link.attrs %}
            {% for key, value in link.attrs %}
              {% if key != "class" %}{{ key }}="{{ value }}"{% endif %}
            {% endfor %}
          {% endif %}
        >
          <span>{{ link.label }}</span>
          {% if icon %}
            {% if icon.slice(0, 4) == "<svg" %}
              {{ icon | safe }}
            {% else %}
              {% lucide icon %}
            {% endif %}
          {% endif %}
        </a>
      {% endfor %}
    </nav>
  </div>
</div>
